<div id='menu'>
	<% if (U.Can("tasks") || _.created_by==U.id) { %>
		<div class='cmd link' id='edit'>
			<%=APP.Icon('edit')%> edit task
		</div>
		<% }%>
			<% if (U.Can("tasks")) { %>
				<div class='cmd link' id='subtask'>
					<%=APP.Icon('new')%> add subtask
				</div>
				<% } %>
					<span id='title'>Task <%=task_id%> :</span>

					<span class='path'><%=path%></span>

					<hr>

					<table id='task-details' class='table table-full table-left '>
						<tr>
							<td id='task_icon' class='' rowspan=55>
								<%=APP.Icon(kind, kind)%>
							</td>
							<th>Task</th>
							<td colspan=3>
								<%=task%>
							</td>

						</tr>
						<tr>
							<th>Priority</th>
							<td>
								<meter min=-1 max=100 value='<%=priority%>'>
									<%=priority%>
								</meter>
							</td>
							<th>Due</th>
							<td class='nowrap'>
								<%=APP.Format.date(due_date)%>
							</td>
						</tr>
						<tr>
							<th>
								Created By
							</th>
							<td>
								<%=APP.GetLink("users",_.created_by)%>
							</td>

							<th>Created</th>
							<td class='nowrap'>
								<%=APP.Format.date(_.created_on)%>
							</td>

						</tr>
						<tr>
							<th>
								Assigned To
							</th>
							<td>
								<%=APP.GetLink("users",assigned_to)%>
							</td>
							<th>Started</th>
							<td class='nowrap'>
								<%=APP.Format.date(start_date)%>
							</td>
						</tr>

						<tr>
							<th>
								Completed By
							</th>
							<td>
								<%=APP.GetLink("users",completed_by)%>
									</th>
									<th>Completed</th>
									<td class='nowrap'>
										<%=APP.Format.date(complete_date)%>
									</td>
						</tr>
					</table>

					<table id='progress-table' class='shadow_box_dark table table-full table-left'>
						<tr>
							<th>Progress</th>
							<td>
								<% if (subtasks==0 && state!="Complete") { %>
									<input value='<%=progress%>' <%=subtasks>0?"disabled":""%> id='progress' list='progress_levels' type=range min=0 max=100 >
									<datalist id="progress_levels">
										<%
										for (var label in states)
											print("<option>"+states[label]+"</option>");
											%>

									</datalist>
									<% } else { %>
										<input id='progress' value='<%=progress%>' type='hidden'>
										<progress value='<%=progress%>' min=0 max=100>
											<% } %>
							</td>
							<td width="150px" id=''>
								<% if (subtasks>0 ) { %>
									<input type='hidden' id='state' value='<%=state%>'>
									<%=state%>
										<% } else {%>
											<select id='state'>
												<%
									for (var label in states)
										print("<option " + (state==label ? "selected": "")+" value='"+label+"'>"+label+"</option>");
										%>
											</select>
											<% } %>
							</td>
						</tr>
					</table>
</div>


<h2>Description</h2>
<div class='description'>
	<%=APP.Format.markdown(description)%>
</div>

<div id='revisions_container'></div>
